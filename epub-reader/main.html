<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <title>EPUB Reader</title>
  <script src="public/javascripts/jszip.min.js"></script>
  <script src="public/javascripts/epub.js"></script>
  <script src="public/javascripts/reader.js"></script>
  <script src="public/javascripts/jquery.min.js"></script>
  <script src="public/javascripts/FileSaver.min.js"></script>
  <link rel="stylesheet" type="text/css" href="public/stylesheets/epub.css">
</head>
<body>
  <div id="epub_input">
    <label id="input_label">Choose EPUB<input id="input" type="file" accept=".epub" hidden/></label>
    <label id="zh_btn" class="lang_label">ZH</label>
    <label id="en_btn" class="lang_label">EN</label>
    <label id="toolbar" style="display:none">TOC</label>
    <div id="mySidenav" class="sidenav" style="display:none">
      <ul id="tocs">
        <li class="grid-container">
          <div id="plus_btn" class="grid-item" style="font-size: 30px">&plus;</div>
          <div id="minus_btn" class="grid-item" style="font-size: 30px">&minus;</div>
        </li>
      </ul>
    </div>
  </div>
  <div id="viewer_out">
    <a id="prev_nav" class="navlink">...</a>
    <div id="viewer" class="scrolled"></div>
    <a id="next_nav" class="navlink">...</a>    
  </div>
  <div id="prev" class="arrow">‹</div>
  <div id="next" class="arrow">›</div>
  <div class="modal-content" id="hl">Highlight</div>
</body>
<script>
  var book = ePub();
  var rendition, filename;
  var font_size = 28;
  var lang_choice = "zh_btn";
  var zh_btn = document.getElementById("zh_btn");
  var en_btn = document.getElementById("en_btn");
  zh_btn.classList.toggle("chosen");
  zh_btn.style.cursor = "not-allowed";
  var inputElement = document.getElementById("input");

  inputElement.addEventListener('change', function (e) {
    var file = e.target.files[0];
    filename = file.name;
    if (window.FileReader) {
        var reader = new FileReader();
        reader.onload = openBook;
        reader.readAsArrayBuffer(file);
        document.title = filename;
        document.getElementById("input_label").remove()
        zh_btn.remove()
        en_btn.remove()
    }
  });

  var toolbarElement = document.getElementById("toolbar");
  toolbarElement.addEventListener("click", function() {
    $('#mySidenav').toggle()
    this.classList.toggle("active");
  });

  $(".lang_label").click(function(){
    switch($(this).attr("id")) {
      case "zh_btn":
        if (!zh_btn.classList.contains("chosen")) {
          zh_btn.classList.toggle("chosen");
          en_btn.classList.toggle("chosen");
          zh_btn.style.cursor = "not-allowed";
          en_btn.style.cursor = "pointer";
        }
        break;
      case "en_btn":
        if (!en_btn.classList.contains("chosen")) {
          zh_btn.classList.toggle("chosen");
          en_btn.classList.toggle("chosen");
          en_btn.style.cursor = "not-allowed";
          zh_btn.style.cursor = "pointer";
        }
        break;
    }
    lang_choice = $(this).attr("id")
  })

  let isMobile = window.matchMedia("only screen and (max-width: 760px)").matches;
  $(".grid-item").click(function(){
    switch($(this).attr("id")) {
      case "plus_btn":
        font_size += 1;
        break;
      case "minus_btn":
        font_size -= 1;
        break;
      }
    rendition.themes.fontSize(`${font_size}px`);
  })
</script>
</html>
