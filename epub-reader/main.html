<!doctype html>
<html lang="en" class="h-100">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>EPUB Reader</title>
    <link rel="icon" type="image/png" href="../assets/favicon.png">
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.0/jszip.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <script src="public/javascripts/handlebars.min.js"></script>
    <script src="public/javascripts/js-epub-maker.js"></script>
    <script src="public/javascripts/epub.min.js"></script>
    <script src="public/javascripts/epub-reader.js"></script>
    <!-- <script src="../text-editor/lib/FileSaver.min.js"></script> -->

    <link rel="stylesheet" type="text/css" href="public/stylesheets/epub-reader.css">

    <script type="text/javascript" src="../assets/particle-network.min.js"></script>
</head>

<body class="h-100">

    <div class="h-100 w-100 p-0 m-0" id="particle"></div>

    <div class="position-absolute top-50 start-50 translate-middle border shadow-sm card-img-overlay" id="setup">
        <p class="lead text-center">EPUB Reader</p>

        <div class="input-group">
            <input type="file" id="input" class="form-control" aria-label="Upload" accept=".epub,.txt,.md" >
        </div>

        <hr class="bg-secondary border-3 border-top border-secondary">

        <div class="input-group d-flex">
            <span class="input-group-text justify-content-center">Input Text</span>
            <textarea class="form-control" aria-label="With textarea" id="text-input" class="w-100 viewer" required></textarea>
            <button class="btn btn-outline-secondary" type="button" onclick="submit()">Submit</button>
        </div>

    </div>

    <div id="epub_config">
        <label id="toolbar" style="display:none" class="py-1">TOC</label>
        <div id="mySidenav" class="sidenav" style="display:none">
            <ul id="tocs">
                <li class="grid-container">
                    <div id="plus_btn" class="grid-item fs-4 font-monospace">&plus;</div>
                    <div id="minus_btn" class="grid-item fs-4 font-monospace">&minus;</div>
                </li>
            </ul>
        </div>
    </div>

    <div id="viewer_out">
        <a id="prev_nav" class="navlink" href="javascript:void(0)">...</a>
        <div id="viewer" class="scrolled"></div>
        <a id="next_nav" class="navlink" href="javascript:void(0)">...</a>    
    </div>
    <div id="prev" class="arrow" style="display: none;">‹</div>
    <div id="next" class="arrow" style="display: none;">›</div>
    <div class="modal-content" id="hl">Highlight</div>

</body>

<script>
    var book = ePub();
    var rendition, filename;
    var font_size = 28;
    var inputElement = document.getElementById("input");
    var isMobile = window.matchMedia("only screen and (max-width: 760px)").matches;

    inputElement.addEventListener('change', function (ev) {
        var file = ev.target.files[0];
        var filename = file.name;
        var filetype = file.type;
        if (window.FileReader) {
            var reader = new FileReader();
            reader.onload = ev => handleFile(ev, filetype);

            if (filetype.includes("epub")) {
                reader.readAsArrayBuffer(file);
            } else {
                reader.readAsText(file);
            }
            document.title = filename;
        }
    });

    var toolbarElement = document.getElementById("toolbar");
    toolbarElement.addEventListener("click", function() {
        $('#mySidenav').toggle();
        this.classList.toggle("active");
        if (this.classList.contains("active")) {
            highlight_chapter();
        } else {
            fold_all();
        }
    });

    $(".grid-item").click(function(){
        switch($(this).attr("id")) {
            case "plus_btn":
                font_size += 1;
                break;
            case "minus_btn":
                font_size -= 1;
                break;
            }
        // rendition.themes.fontSize(`${font_size}px`);
        rendition.themes.override("font-size", `${font_size}px`, true);
    });

</script>

<script>
    var canvas_div = document.getElementById("particle");

    var options = {
        particleColor: '#333',
        background: '#fafafa',
        interactive: false,
        speed: 0.16,
        density: 18000   // 'low': 20000, 'medium': 10000
    };

    var particle_canvas = new ParticleNetwork(canvas_div, options);
</script>

</html>
