<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>EPUB Reader</title>
  <script src="public/javascripts/jszip.min.js"></script>
  <script src="public/javascripts/epub.js"></script>
  <script src="public/javascripts/reader.js"></script>
  <script src="public/javascripts/jquery.min.js"></script>
  <script src="public/javascripts/FileSaver.min.js"></script>
  <link rel="stylesheet" type="text/css" href="public/stylesheets/epub.css">
</head>
<body>
  <div id="epub_input">
    <label id="input_label">Choose EPUB<input id="input" type="file" accept=".epub" hidden/></label>
    <label id="toolbar" style="display:none">&#9776;  TOC</label>
    <label id="annotbar" style="display:none">&#9734;  Highlights</label>
    <div id="mySidenav" class="sidenav" style="display:none">
      <ul id="tocs">
        <li class="grid-container">
          <div id="plus_btn" class="grid-item" style="font-size: 30px">&plus;</div>
          <div id="minus_btn" class="grid-item" style="font-size: 30px">&minus;</div>
          <div id="lang_btn" class="grid-item">ZH/EN</div>
        </li>
      </ul>
    </div>
    <div id="extras" class="sidenav" style="display:none">
      <ul id="highlights">
        <li style="text-align: right; padding: 3px 3px;" onclick="saveAnnotation();">Download Annotation</li>
      </ul>
    </div>
  </div>
  <div id="viewer_out">
    <a id="prev_nav" class="navlink">...</a>
    <div id="viewer" class="scrolled"></div>
    <a id="next_nav" class="navlink">...</a>    
  </div>
  <div id="prev" class="arrow">‹</div>
  <div id="next" class="arrow">›</div>
  <div class="modal-content" id="hl">Highlight</div>
</body>
<script>
  var book = ePub();
  var rendition, filename;
  var font_size = 28;
  var lang_choice = 1;
  var inputElement = document.getElementById("input");

  inputElement.addEventListener('change', function (e) {
    var file = e.target.files[0];
    filename = file.name;
    if (window.FileReader) {
        var reader = new FileReader();
        reader.onload = openBook;
        reader.readAsArrayBuffer(file);
        document.title = filename;
        document.getElementById("input_label").remove()
    }
  });

  var toolbarElement = document.getElementById("toolbar");
  toolbarElement.addEventListener("click", function() {
    $('#mySidenav').toggle()
    this.classList.toggle("active");
  });

  var annotbarElement = document.getElementById("annotbar");
  annotbarElement.addEventListener("click", function() {
    $('#extras').toggle()
    this.classList.toggle("active");
  });

  let isMobile = window.matchMedia("only screen and (max-width: 760px)").matches;
  $(".grid-item").click(function(){
    switch($(this).attr("id")) {
      case "plus_btn":
        font_size += 1;
        break;
      case "minus_btn":
        font_size -= 1;
        break;
      case "lang_btn":
        lang_choice *= -1;
        if (lang_choice == -1) {
          rendition.themes.font("Verdana");
          font_size = isMobile? 18 : 25;
        } else {
          rendition.themes.font("PingFangHK-Thin");
          font_size = isMobile? 21 : 28;
        }
        break;
      }
    rendition.themes.fontSize(`${font_size}px`);
  })
</script>
</html>
